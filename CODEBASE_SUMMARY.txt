================================================================================
RAYO-SENSE V2 CODEBASE - QUICK REFERENCE SUMMARY
================================================================================

PROJECT OVERVIEW:
  Name: Rayo-Sense Admin Dashboard v2.0.2
  Framework: Next.js 15.2.3 with React 19
  TypeScript: Yes (strict mode)
  Database: MongoDB (blogs) + Supabase/PostgreSQL (entities)
  Auth: Supabase Auth with admin-only access
  Status: Production-ready admin panel

TECH STACK:
  Frontend: React 19, Next.js 15.2.3
  Styling: Tailwind CSS 4.0 + Forms plugin
  Charts: ApexCharts, FullCalendar, React JVectorMap
  UI: 72 custom components, React Icons
  Form: Flatpickr (date picker), react-dropzone (file upload), react-dnd
  State: React Context (Auth, Theme, Sidebar)
  Database Driver: MongoDB Node client, Supabase client
  Payment: Razorpay integration

KEY DIRECTORIES:
  /src/app/(admin)/*      - Protected admin pages (dashboard, users, projects, blogs)
  /src/app/api/*          - RESTful API endpoints (auth, users, projects, blogs, analytics)
  /src/components         - React components (UI, auth, forms, dashboard)
  /src/context            - Global state (Auth, Theme, Sidebar)
  /src/lib                - Utilities (database, auth, Supabase clients)
  /src/layout             - Layout components (header, sidebar)
  /src/services           - API client services

DATABASE SCHEMA:
  MongoDB Collections:
    - blogs: title, user_id, project_id, created_at, words_count, status
  
  Supabase Tables:
    - auth.users: Supabase Auth users with role metadata
    - projects: name, url, user_id, gsc_connected status
    - accounts: billing info, plan type (free/pro), payment history
    - user_information: additional user data
    - gsc_accounts: Google Search Console connections
    - razorpay_payments: payment records (amount, currency, status)

AUTHENTICATION:
  Method: Email/password via Supabase Auth
  Flow: Login -> Verify admin role -> Set httpOnly cookie -> Redirect to dashboard
  Session: 30-second periodic verification, 7-day token expiration
  Protection: All protected routes require admin/administrator role
  
API ENDPOINTS: (20 total)
  Auth (3): /api/auth/{signin,signout,session}
  Users (8): /api/users/* (list, create, get, update, delete, blogs, projects, invoices, usage)
  Projects (7): /api/projects/* (list, create, get, update, delete, status, recent)
  Blogs (2): /api/blogs/* (list, recent)
  Payments (1): /api/payments/recent
  Analytics (5): /api/analytics/* (metrics, active-users, user-growth, blogs-growth, project-growth)

MAIN PAGES:
  / (admin/page.tsx)                - Dashboard with metrics & charts
  /user (admin/user/page.tsx)       - User list management
  /user/[id] (admin/user/[id])      - User details page
  /projects (admin/projects)        - Project management
  /blogs (admin/blogs)              - Blog management
  /signin (full-width-pages)        - Admin login page
  
CORE COMPONENTS:
  Auth: AuthGuard, SignInForm
  Users: UserList, UsersTable
  Forms: PhoneInput, InputField, TextArea, DatePicker, FileInput, Checkbox, Radio
  UI: Button, Table, Modal, Pagination, Badge, Avatar, Alert, Dropdown, Skeleton
  Dashboard: ActiveUsers, BlogsGrowth, ProjectGrowth, RecentActivity
  
INTERNATIONAL SUPPORT:
  ✓ Billing country field in accounts table
  ✓ PhoneInput with country codes dropdown (extensible)
  ✓ Currency field in payments
  ✓ Razorpay multi-currency support
  ✗ No specific Saudi Arabia or UAE features yet
  
  Opportunities:
    - Add +966 (KSA), +971 (UAE) to phone codes
    - Implement VAT (KSA: 15%, UAE: 5%)
    - Add Arabic language support
    - Add Moyasar/2Checkout payment gateways

SECURITY FEATURES:
  ✓ Admin-only routes with requireAdmin() middleware
  ✓ httpOnly cookies for token storage (XSS protection)
  ✓ Secure flag in production, SameSite=lax (CSRF protection)
  ✓ Session validation on every request
  ✗ No rate limiting implemented
  ✗ No API request signing
  ✗ No audit logging

KEY FILES:
  Context: /src/context/AuthContext.tsx (242 lines)
  Auth Middleware: /src/lib/auth/requireAdmin.ts (40 lines)
  Database: /src/lib/mongodb.ts (75 lines)
  Users API: /src/app/api/users/route.ts (199 lines)
  Blogs API: /src/app/api/blogs/route.ts (122 lines)
  Analytics: /src/app/api/analytics/metrics/route.ts
  Config: next.config.ts, tsconfig.json, middleware.ts

PATTERNS & CONVENTIONS:
  1. All API routes except /auth require await requireAdmin()
  2. Pagination: default 10, max 50 per page
  3. Search: Case-insensitive across multiple fields
  4. Error Handling: Custom AdminAccessError class, centralized handleApiError()
  5. Caching: 5-minute TTL for user count, no-store for real-time data
  6. User Normalization: normalizeUser() converts Supabase users to consistent format

PERFORMANCE:
  ✓ User count caching (5-min TTL)
  ✓ Large batches use 1000-per-page for efficiency
  ✓ Table pagination prevents full-page loads
  ✓ Image optimization via next/image
  ✓ Skeleton loading states
  
MISSING/INCOMPLETE:
  ✗ Blog creation/update POST /api/blogs
  ✗ Full blog content retrieval
  ✗ Project update endpoint
  ✗ User deletion fully tested
  ✗ Rate limiting
  ✗ Comprehensive error logging
  ✗ API documentation/OpenAPI
  ✗ Unit tests

ENVIRONMENT VARIABLES NEEDED:
  MONGODB_URL              - MongoDB connection string
  MONGODB_USERNAME         - MongoDB auth user
  MONGODB_PASSWORD         - MongoDB auth password
  MONGODB_DB_NAME          - Database name (rayodb)
  MONGODB_AUTH_SOURCE      - Auth source (admin)
  NEXT_PUBLIC_SUPABASE_URL - Supabase instance URL
  NEXT_PUBLIC_SUPABASE_ANON_KEY - Supabase anon key
  SUPABASE_SERVICE_ROLE_KEY - Service role for admin operations

DEPLOYMENT READY:
  ✓ Environment-based configuration
  ✓ Production build optimized
  ✓ Secure cookie flags for production
  ✓ httpOnly token storage
  ✓ Admin-only data access
  
RECOMMENDATIONS:
  1. Add rate limiting (e.g., express-rate-limit or similar)
  2. Implement comprehensive audit logging
  3. Add more granular role-based access control (RBAC)
  4. Setup error monitoring (Sentry, LogRocket)
  5. Add API documentation (Swagger/OpenAPI)
  6. Implement comprehensive test suite
  7. Add Saudi/UAE specific features if targeting those markets
  8. Setup database backup/recovery procedures
  9. Add request signing for external API calls
  10. Implement webhook logging for payment events

================================================================================
For detailed information, see CODEBASE_ANALYSIS.md in project root
================================================================================
